<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{ metadata.rfp_title }} - {{ metadata.prime_firm }}</title>
    <style>
      {{ base_css }}
    </style>
    {% if variant_css %}
    <style>
      {{ variant_css }}
    </style>
    {% endif %}
  </head>
  <body>
    <header class="proposal-header">
      <div class="title">{{ metadata.rfp_title }}</div>
      <p><strong>Client:</strong> {{ metadata.client }}</p>
      <p><strong>Submitted by:</strong> {{ metadata.prime_firm }}</p>
    </header>

    <section class="metadata">
      <div class="metadata-grid">
        <div><strong>RFP Number:</strong> {{ metadata.rfp_number }}</div>
        <div><strong>Agency:</strong> {{ metadata.agency }}</div>
        <div><strong>Agency Type:</strong> {{ metadata.agency_type }}</div>
        <div><strong>Sector:</strong> {{ metadata.sector }}</div>
        <div><strong>Submission Date:</strong> {{ metadata.submission_date }}</div>
        <div><strong>Submission Method:</strong> {{ metadata.submission_method }}</div>
        <div>
          <strong>Addenda:</strong>
          {% if metadata.addenda %}
            {{ metadata.addenda | length }} issued
          {% else %}
            None
          {% endif %}
        </div>
      </div>
    </section>

    <section class="toc">
      <h2>Table of Contents</h2>
      <ul>
        <li>Letter of Transmittal</li>
        <li>Qualifications and Experience</li>
        <li>Staffing Plan</li>
        <li>Subconsultant Team</li>
        <li>Work Approach</li>
        <li>Schedule</li>
        <li>References</li>
        <li>Appendices</li>
      </ul>
    </section>

    <section>
      <h2>Letter of Transmittal</h2>
      {% for paragraph in letter.body %}
      <p>{{ paragraph }}</p>
      {% endfor %}
      <p><strong>{{ letter.closing }}</strong></p>
      {% if letter.signature_block %}
      <p>{{ letter.signature_block.name }}<br />{{ letter.signature_block.title }}<br />{{ letter.signature_block.date }}</p>
      {% endif %}
    </section>

    <section>
      <h2>Qualifications and Experience</h2>
      {% for qualification in qualifications %}
        <h3>{{ qualification.title }}</h3>
        <p>{{ qualification.description }}</p>
        {% if qualification.highlights %}
          <ul>
            {% for highlight in qualification.highlights %}
            <li>{{ highlight }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endfor %}
    </section>

    <section>
      <h2>Staffing Plan</h2>
      <div class="two-column">
        <div>
          <h3>Project Manager</h3>
          <p><strong>{{ team.pm.name }}</strong> — {{ team.pm_title }}</p>
          <p>{{ team.pm_summary }}</p>
        </div>
        <div>
          <h3>Quality Manager</h3>
          <p><strong>{{ team.quality_manager.name }}</strong> — {{ team.qm_title }}</p>
          <p>{{ team.qm_summary }}</p>
        </div>
      </div>
      <p>{{ staffing_plan.overview | join(' ') }}</p>
      <h3>Availability</h3>
      <ul>
        {% for note in staffing_plan.availability %}
        <li>{{ note }}</li>
        {% endfor %}
      </ul>
      <h3>Resource Matrix</h3>
      <ul>
        {% for row in staffing_plan.resource_matrix %}
        <li>{{ row.role }} — {{ row.name }} ({{ row.allocation_percent }}%)</li>
        {% endfor %}
      </ul>
      <h3>Technical Leads</h3>
      <ul>
        {% for lead in team.technical_leads %}
        <li><strong>{{ lead.role }}:</strong> {{ lead.name }} — {{ lead.bio }}</li>
        {% endfor %}
      </ul>
      <h3>Subconsultant Team</h3>
      <ul>
        {% for sub in team.subs %}
        <li>
          <strong>{{ sub.name }}</strong> ({{ "DBE" if sub.dbe else "Non-DBE" }}) — {{ sub.role }}.
          Scope: {{ sub.scope }}
        </li>
        {% endfor %}
      </ul>
      <h3>Subconsultant Delivery Approach</h3>
      <p>{{ subs_summary.approach | join(' ') }}</p>
      <p>{{ subs_summary.dbe_strategy | join(' ') }}</p>
    </section>

    <section>
      <h2>Work Approach</h2>
      <p>{{ work_approach.executive_summary }}</p>
      <h3>Objectives</h3>
      <ul>
        {% for objective in work_approach.objectives %}
        <li>{{ objective }}</li>
        {% endfor %}
      </ul>
      <h3>Constraints</h3>
      <ul>
        {% for constraint in work_approach.constraints %}
        <li>{{ constraint }}</li>
        {% endfor %}
      </ul>
      <h3>Success Factors</h3>
      <ul>
        {% for factor in work_approach.success_factors %}
        <li>{{ factor }}</li>
        {% endfor %}
      </ul>

      {% for element in work_approach.elements %}
      <article>
        <h3>{{ element.id }} — {{ element.title }}</h3>
        <p>{{ element.context }}</p>
        <ul>
          {% for activity in element.activities %}
          <li>{{ activity }}</li>
          {% endfor %}
        </ul>
      </article>
      {% endfor %}
    </section>

    <section>
      <h2>Schedule and Deliverables</h2>
      <p><strong>Period of Performance:</strong> {{ schedule.start_date }} through {{ schedule.end_date }}</p>
      <h3>Milestones</h3>
      <ul>
        {% for milestone in schedule.milestones %}
        <li><strong>{{ milestone.name }} ({{ milestone.date }})</strong> — {{ milestone.description }}</li>
        {% endfor %}
      </ul>
      <h3>Critical Path Narrative</h3>
      <p>{{ schedule.critical_path.narrative }}</p>
      <ul>
        {% for driver in schedule.critical_path.drivers %}
        <li>{{ driver }}</li>
        {% endfor %}
      </ul>
      <p><strong>Questions Due:</strong> {{ schedule.questions_due }}</p>
    </section>

    <section>
      <h2>References</h2>
      <ul>
        {% for reference in appendices.E.references %}
        <li>
          <strong>{{ reference.client }}</strong> — {{ reference.description }}.
          Contact: {{ reference.contact }} ({{ reference.email }}, {{ reference.phone }})
        </li>
        {% endfor %}
      </ul>
    </section>

    <section>
      <h2>Appendices</h2>
      <h3>Appendix A — Addenda Acknowledgment</h3>
      <ul>
        {% for ack in appendices.A.addenda_acknowledgment %}
        <li>Addendum {{ ack.addendum_number }} — Acknowledged: {{ ack.acknowledged }}. Notes: {{ ack.notes }}</li>
        {% endfor %}
      </ul>
      <h3>Appendix B — DBE Plan</h3>
      <ul>
        {% for dbe in appendices.B.dbe_plan %}
        <li>{{ dbe.firm }} — {{ dbe.role }} ({{ dbe.commitment_percent }}%)</li>
        {% endfor %}
      </ul>
      <h3>Appendix C — Resumes</h3>
      <div>
        {% for resume in appendices.C.resumes %}
        <div class="resume-card">
          <strong>{{ resume.name }}</strong>, {{ resume.role }} ({{ resume.years_experience }} years)
          <p>{{ resume.summary }}</p>
        </div>
        {% endfor %}
      </div>
      <h3>Appendix D — Forms</h3>
      <ul>
        <li>Non-Collusion Affidavit: {{ appendices.D.forms.non_collusion }}</li>
        <li>Insurance Acknowledgment: {{ appendices.D.forms.insurance_ack }}</li>
        <li>Certification Regarding Lobbying: {{ appendices.D.forms.certification }}</li>
      </ul>
      <h3>Appendix E — Compliance Checklist</h3>
      <ul>
        <li>Page Limit Required: {{ checklist.page_limit_required }}</li>
        <li>DBE Goal Percent: {{ checklist.dbe_goal_percent }}%</li>
        <li>Addenda Required: {{ checklist.addenda_required }}</li>
        <li>Resumes Required: {{ checklist.resumes_required }}</li>
        <li>Insurance Certificate Required: {{ checklist.insurance_certificate }}</li>
      </ul>
    </section>

    <section class="footnote-section">
      <p>Prime Firm: {{ metadata.prime_firm }} | RFP: {{ metadata.rfp_number }}</p>
      <p>Prepared for {{ metadata.agency }} — {{ metadata.submission_date }}</p>
    </section>
  </body>
</html>
